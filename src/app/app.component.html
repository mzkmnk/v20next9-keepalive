<div class="container">
  <h1>HTTP Keepalive Demo</h1>

  <div class="input-section">
    <label for="numberOfRequests">Number of Requests: </label>
    <input type="number" id="numberOfRequests" [(ngModel)]="numberOfRequests" />
  </div>

  <div class="test-sections">
    <div class="test-section">
      <h2>With Keepalive</h2>
      <button (click)="sendRequests('keepalive')" [disabled]="loadingKeepalive">
        Run Keepalive Test
      </button>
      <div *ngIf="keepaliveTime !== null">
        Time: {{ keepaliveTime | number:'1.0-2' }} ms
      </div>
      <div *ngIf="loadingKeepalive">Loading...</div>
      <ul>
        <li *ngFor="let result of keepaliveResults">{{ result }}</li>
      </ul>
    </div>

    <div class="test-section">
      <h2>Without Keepalive (Connection: close)</h2>
      <button (click)="sendRequests('no-keepalive')" [disabled]="loadingNoKeepalive">
        Run No Keepalive Test
      </button>
      <div *ngIf="noKeepaliveTime !== null">
        Time: {{ noKeepaliveTime | number:'1.0-2' }} ms
      </div>
      <div *ngIf="loadingNoKeepalive">Loading...</div>
      <ul>
        <li *ngFor="let result of noKeepaliveResults">{{ result }}</li>
      </ul>
    </div>
  </div>

  <div class="documentation-section">
    <h2>About HTTP Keepalive</h2>
    <p>
      HTTP Keepalive, also known as HTTP persistent connection, is a feature that allows a single TCP connection to remain open for multiple HTTP requests and responses. Without keepalive, a new TCP connection needs to be established for each request, which adds overhead due to the TCP handshake process (SYN, SYN-ACK, ACK).
    </p>
    <p>
      This application demonstrates the difference by making a series of requests to two different server endpoints:
      <ul>
          <li><b>With Keepalive (/keepalive):</b> The server keeps the connection open for subsequent requests. This typically results in a faster total time for all requests.</li>
          <li><b>Without Keepalive (/no-keepalive):</b> The server explicitly closes the connection after each request (using the 'Connection: close' header). This simulates the behavior of HTTP/1.0 or when keepalive is disabled, requiring a new connection for each request and thus taking longer.</li>
      </ul>
      Compare the time taken for both tests to see the impact of keepalive. The difference becomes more noticeable with a higher number of requests.
    </p>
  </div>
</div>
